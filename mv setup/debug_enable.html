<script src="https://video.seenthis.se/public/patrik/high-impact.min.js"></script>
<script>

window.highImpactJs = window.highImpactJs || { cmd: [] };

function updateAdUnit(adUnitId, adUnitKey, config) {
    console.log('updateAdUnit called with:', { adUnitId, adUnitKey, config });

    window.highImpactJs.cmd.push(() => {
        console.log('Executing highImpactJs.cmd function for adUnit:', adUnitId);

        window.highImpactJs.setConfig({
            plugins: ['gam'], // What adserver plugin to use
            zIndex: 1,
        });
        console.log('highImpactJs.setConfig called with:', { plugins: ['gam'], zIndex: 1 });

        // Use the config-specific peekAmount in setTemplateConfig
        window.highImpactJs.setTemplateConfig(config.template, { peekAmount: config.peekAmount });
        console.log('highImpactJs.setTemplateConfig called with:', { template: config.template, peekAmount: config.peekAmount });

        // Define slot with dynamic values from the config object
        window.highImpactJs.defineSlot({
            slot: config.slot, // The GAM ad slot name
            template: config.template, // Which template to use
            sizes: config.sizes, // Ad sizes
            adUnitId: adUnitId, // Id of the ad slot wrapper div on the loaded page
            waitForAdSignal: true, // Default is false
        });
        console.log('highImpactJs.defineSlot called with:', {
            slot: config.slot,
            template: config.template,
            sizes: config.sizes,
            adUnitId: adUnitId,
            waitForAdSignal: true,
        });
    });
}

// Get the dynamic div id generated from AY, via prebid ad unit targeting info
pbjs.onEvent('setTargeting', function(eventData) {
    console.log('pbjs.onEvent setTargeting called with eventData:', eventData);

    const options = {{ seenThisOptions }};
    console.log('seenThisOptions:', options);

    for (var adUnitId in eventData) {
        const adUnitName = adUnitId.replace('div-gpt-ad-', '').replace(/__ayManagerEnv__.+/, '');
        console.log('Processing adUnitId:', adUnitId, ' -> adUnitName:', adUnitName);

        var adUnitOption = options[adUnitName];
        if (adUnitOption) {
            console.log('Found config for adUnitName:', adUnitName, ' -> adUnitOption:', adUnitOption);
            updateAdUnit(adUnitId, adUnitName, adUnitOption);
        } else {
            console.log('No config found for adUnitName:', adUnitName);
        }
    }
});

</script>